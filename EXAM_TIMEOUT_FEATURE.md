# 考试超时自动提交功能测试

## 功能说明

现在考试系统已经实现了超时自动提交功能：

### 前端倒计时
1. 考试页面会显示剩余时间倒计时
2. 当倒计时到达 0 时，会自动调用提交函数
3. 倒计时在最后 5 分钟时会变为红色警告

### 后端超时检查
1. 每次访问考试页面时，服务器会检查是否超时
2. 如果考试已经超时，服务器会：
   - 自动计算得分
   - 将考试状态设置为 'completed'
   - 返回超时提交信息
   - 前端自动跳转到结果页面

### 双重保护
- 前端倒计时确保用户看到时间警告
- 后端检查确保即使页面刷新或网络问题也能正确处理超时

## 测试方法

### 方法1：创建短时间考试模板
1. 访问 `/admin/exam-templates`
2. 创建一个时间限制为 1 分钟的考试模板
3. 开始考试并等待1分钟观察自动提交

### 方法2：修改现有考试时间
1. 访问数据库管理页面
2. 找到正在进行的考试记录
3. 手动修改开始时间，使其看起来已经超时
4. 刷新考试页面，应该自动跳转到结果页面

### 方法3：检查倒计时显示
1. 开始任何有时间限制的考试
2. 确认页面右上角显示倒计时
3. 观察时间递减
4. 在最后几分钟时间应该变红

## 超时处理流程

1. **用户开始考试** → 设置倒计时
2. **时间快到时** → 倒计时变红色警告
3. **时间到达0** → 前端自动调用提交
4. **用户刷新页面** → 后端检查超时并自动提交
5. **自动跳转** → 显示考试结果

## 技术实现

### 前端 (exam/[id]/page.tsx)
- `useEffect` 倒计时器
- 时间到达0时调用 `handleSubmit()`
- 处理超时响应 (410 状态码)

### 后端 (api/exam/route.ts)
- GET 请求时检查超时
- 自动计算得分并提交
- 返回 410 状态码表示已过期

### 数据更新
- 状态: `in-progress` → `completed`
- 记录结束时间和得分
- 保存考试时长(分钟和秒)
